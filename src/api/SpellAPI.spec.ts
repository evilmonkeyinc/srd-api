import spells from '../../public/spells.json';
import SpellAPI, { Query } from './SpellAPI';
import Spell, { School, Area, CastingTime, Duration } from '../models/Spell';
import * as io_ts from 'io-ts';
import { ThrowReporter } from 'io-ts/lib/ThrowReporter';
import { optional, descriptionInterface } from '../../lib/test';
import { AttackType } from '../shared/Attacks';
import { Ability } from '../shared/Abilities';
import { DamageType } from '../shared/DamageType';

describe('spells.get', () => {

    const tests: {
        name: string,
        input: string,
        expected: {
            name: string;
            found: boolean;
        }
    }[] = [
            {
                name: 'Fireball, case sensitive',
                input: 'Fireball',
                expected: {
                    name: 'Fireball',
                    found: true,
                }
            },
            {
                name: 'Fireball, case insensitive',
                input: 'fireball',
                expected: {
                    name: 'Fireball',
                    found: true,
                }
            }
        ];

    const spellAPI = new SpellAPI(spells as Spell[]);

    tests.forEach((test) => {
        it(test.name, (done) => {
            const actual = spellAPI.get(test.input);
            if (test.expected.found) {
                expect(actual).toBeDefined();
                if (actual !== undefined) {
                    expect(actual.name).toEqual(test.expected.name);
                }
            } else {
                expect(actual).toBeUndefined();
            }
            done();
        })
    });
});

describe('spells.list', () => {

    const spellAPI = new SpellAPI(spells as Spell[]);

    const spellList = spellAPI.list();

    expect(spellList).toBeDefined();
    expect(spellList.length).toEqual(304);
});

describe('spells.query', () => {

    const tests: {
        name: string,
        query: Query,
        expected: {
            results: number;
            names: string[];
        }
    }[] = [
            {
                name: 'list all cantrips',
                query: {
                    levels: [0],
                },
                expected: {
                    names: [
                        'Acid Splash',
                        'Chill Touch',
                        'Dancing Lights',
                        'Druidcraft',
                        'Eldritch Blast',
                        'Fire Bolt',
                        'Guidance',
                        'Light',
                        'Mage Hand',
                        'Mending',
                        'Message',
                        'Minor Illusion',
                        'Poison Spray',
                        'Prestidigitation',
                        'Produce Flame',
                        'Ray of Frost',
                        'Resistance',
                        'Sacred Flame',
                        'Shillelagh',
                        'Shocking Grasp',
                        'Spare the Dying',
                        'Thaumaturgy',
                        'True Strike',
                        'Vicious Mockery',
                    ],
                    results: 24,
                }
            },
            {
                name: 'list wizard spells',
                query: {
                    classes: [
                        'Wizard',
                    ]
                },
                expected: {
                    names: [
                        'Acid Splash',
                        'Alarm',
                        'Alter Self',
                        'Animate Dead',
                        'Animate Objects',
                        'Antimagic Field',
                        'Antipathy/Sympathy',
                        'Arcane Eye',
                        'Arcane Lock',
                        'Astral Projection',
                        'Banishment',
                        'Bestow Curse',
                        'Blight',
                        'Blindness/Deafness',
                        'Blink',
                        'Blur',
                        'Burning Hands',
                        'Chain Lightning',
                        'Charm Person',
                        'Chill Touch',
                        'Circle of Death',
                        'Clairvoyance',
                        'Clone',
                        'Cloudkill',
                        'Color Spray',
                        'Comprehend Languages',
                        'Cone of Cold',
                        'Confusion',
                        'Conjure Elemental',
                        'Conjure Minor Elementals',
                        'Contact Other Plane',
                        'Contingency',
                        'Continual Flame',
                        'Control Water',
                        'Control Weather',
                        'Counterspell',
                        'Create Undead',
                        'Creation',
                        'Dancing Lights',
                        'Darkness',
                        'Darkvision',
                        'Delayed Blast Fireball',
                        'Demiplane',
                        'Detect Magic',
                        'Detect Thoughts',
                        'Dimension Door',
                        'Disguise Self',
                        'Disintegrate',
                        'Dispel Magic',
                        'Dominate Monster',
                        'Dominate Person',
                        'Dream',
                        'Enlarge/Reduce',
                        'Etherealness',
                        'Expeditious Retreat',
                        'Eyebite',
                        'Fabricate',
                        'False Life',
                        'Fear',
                        'Feather Fall',
                        'Feeblemind',
                        'Find Familiar',
                        'Finger of Death',
                        'Fireball',
                        'Fire Bolt',
                        'Fire Shield',
                        'Flaming Sphere',
                        'Flesh to Stone',
                        'Fly',
                        'Fog Cloud',
                        'Forcecage',
                        'Foresight',
                        'Gaseous Form',
                        'Gate',
                        'Geas',
                        'Gentle Repose',
                        'Globe of Invulnerability',
                        'Glyph of Warding',
                        'Grease',
                        'Greater Invisibility',
                        'Guards and Wards',
                        'Gust of Wind',
                        'Hallucinatory Terrain',
                        'Haste',
                        'Hold Monster',
                        'Hold Person',
                        'Hypnotic Pattern',
                        'Ice Storm',
                        'Identify',
                        'Illusory Script',
                        'Imprisonment',
                        'Incendiary Cloud',
                        'Invisibility',
                        'Jump',
                        'Knock',
                        'Legend Lore',
                        'Levitate',
                        'Light',
                        'Lightning Bolt',
                        'Locate Creature',
                        'Locate Object',
                        'Longstrider',
                        'Mage Armor',
                        'Mage Hand',
                        'Magic Circle',
                        'Magic Jar',
                        'Magic Missile',
                        'Magic Mouth',
                        'Magic Weapon',
                        'Major Image',
                        'Mass Suggestion',
                        'Maze',
                        'Mending',
                        'Message',
                        'Meteor Swarm',
                        'Mind Blank',
                        'Minor Illusion',
                        'Mirage Arcane',
                        'Mirror Image',
                        'Mislead',
                        'Misty Step',
                        'Modify Memory',
                        'Mordenkainen’s Sword',
                        'Move Earth',
                        'Nondetection',
                        'Otto’s Irresistible Dance',
                        'Passwall',
                        'Phantasmal Killer',
                        'Phantom Steed',
                        'Planar Binding',
                        'Plane Shift',
                        'Poison Spray',
                        'Polymorph',
                        'Power Word Kill',
                        'Power Word Stun',
                        'Prestidigitation',
                        'Prismatic Spray',
                        'Prismatic Wall',
                        'Programmed Illusion',
                        'Project Image',
                        'Protection from Energy',
                        'Protection from Evil and Good',
                        'Ray of Enfeeblement',
                        'Ray of Frost',
                        'Remove Curse',
                        'Reverse Gravity',
                        'Rope Trick',
                        'Scorching Ray',
                        'Scrying',
                        'See Invisibility',
                        'Seeming',
                        'Sending',
                        'Sequester',
                        'Shapechange',
                        'Shatter',
                        'Shield',
                        'Shocking Grasp',
                        'Silent Image',
                        'Simulacrum',
                        'Sleep',
                        'Sleet Storm',
                        'Slow',
                        'Spider Climb',
                        'Stinking Cloud',
                        'Stone Shape',
                        'Stoneskin',
                        'Suggestion',
                        'Sunbeam',
                        'Sunburst',
                        'Symbol',
                        'Telekinesis',
                        'Teleport',
                        'Teleportation Circle',
                        'Thunderwave',
                        'Time Stop',
                        'Tongues',
                        'True Polymorph',
                        'True Seeing',
                        'True Strike',
                        'Unseen Servant',
                        'Vampiric Touch',
                        'Wall of Fire',
                        'Wall of Force',
                        'Wall of Ice',
                        'Wall of Stone',
                        'Water Breathing',
                        'Web',
                        'Weird',
                        'Wish',
                    ],
                    results: 189,
                }
            },
            {
                name: 'list evocation spells',
                query: {
                    schools: [
                        School.Evocation,
                    ]
                },
                expected: {
                    names: ['Blade Barrier',
                        'Branding Smite',
                        'Burning Hands',
                        'Chain Lightning',
                        'Cone of Cold',
                        'Contingency',
                        'Continual Flame',
                        'Cure Wounds',
                        'Dancing Lights',
                        'Darkness',
                        'Daylight',
                        'Delayed Blast Fireball',
                        'Divine Favor',
                        'Divine Word',
                        'Earthquake',
                        'Eldritch Blast',
                        'Faerie Fire',
                        'Fireball',
                        'Fire Bolt',
                        'Fire Shield',
                        'Fire Storm',
                        'Flame Blade',
                        'Flame Strike',
                        'Forcecage',
                        'Guiding Bolt',
                        'Gust of Wind',
                        'Hallow',
                        'Heal',
                        'Healing Word',
                        'Hellish Rebuke',
                        'Ice Storm',
                        'Light',
                        'Lightning Bolt',
                        'Magic Missile',
                        'Mass Cure Wounds',
                        'Mass Heal',
                        'Mass Healing Word',
                        'Meteor Swarm',
                        'Moonbeam',
                        'Mordenkainen’s Sword',
                        'Prayer of Healing',
                        'Prismatic Spray',
                        'Ray of Frost',
                        'Sacred Flame',
                        'Scorching Ray',
                        'Sending',
                        'Shatter',
                        'Shocking Grasp',
                        'Spiritual Weapon',
                        'Sunbeam',
                        'Sunburst',
                        'Thunderwave',
                        'Wall of Fire',
                        'Wall of Force',
                        'Wall of Ice',
                        'Wall of Stone',
                        'Wind Wall',],
                    results: 57,
                }
            },
            {
                name: 'list wizard cantrips',
                query: {
                    classes: [
                        'Wizard',
                    ],
                    levels: [
                        0,
                    ],
                },
                expected: {
                    names: [
                        'Acid Splash',
                        'Chill Touch',
                        'Dancing Lights',
                        'Fire Bolt',
                        'Light',
                        'Mage Hand',
                        'Mending',
                        'Message',
                        'Minor Illusion',
                        'Poison Spray',
                        'Prestidigitation',
                        'Ray of Frost',
                        'Shocking Grasp',
                        'True Strike',
                    ],
                    results: 14,
                }
            },
            {
                name: 'list wizard evocation cantrips',
                query: {
                    classes: [
                        'Wizard',
                    ],
                    levels: [
                        0,
                    ],
                    schools: [
                        School.Evocation,
                    ]
                },
                expected: {
                    names: [
                        'Dancing Lights',
                        'Fire Bolt',
                        'Light',
                        'Ray of Frost',
                        'Shocking Grasp',
                    ],
                    results: 5,
                }
            },
            {
                name: 'list wizard evocation cantrips, lowercase',
                query: {
                    classes: [
                        'wizard',
                    ],
                    levels: [
                        0,
                    ],
                    schools: [
                        School.Evocation,
                    ]
                },
                expected: {
                    names: [
                        'Dancing Lights',
                        'Fire Bolt',
                        'Light',
                        'Ray of Frost',
                        'Shocking Grasp',
                    ],
                    results: 5,
                }
            },
            {
                name: 'list all 1st and 2nd level spells',
                query: {
                    levels: [1, 2],
                },
                expected: {
                    names: [
                        'Aid',
                        'Alarm',
                        'Alter Self',
                        'Animal Friendship',
                        'Animal Messenger',
                        'Arcane Lock',
                        'Augury',
                        'Bane',
                        'Barkskin',
                        'Bless',
                        'Blindness/Deafness',
                        'Blur',
                        'Branding Smite',
                        'Burning Hands',
                        'Calm Emotions',
                        'Charm Person',
                        'Color Spray',
                        'Command',
                        'Comprehend Languages',
                        'Continual Flame',
                        'Create or Destroy Water',
                        'Cure Wounds',
                        'Darkness',
                        'Darkvision',
                        'Detect Evil and Good',
                        'Detect Magic',
                        'Detect Poison and Disease',
                        'Detect Thoughts',
                        'Disguise Self',
                        'Divine Favor',
                        'Enhance Ability',
                        'Enlarge/Reduce',
                        'Entangle',
                        'Enthrall',
                        'Expeditious Retreat',
                        'Faerie Fire',
                        'False Life',
                        'Feather Fall',
                        'Find Familiar',
                        'Find Steed',
                        'Find Traps',
                        'Flame Blade',
                        'Flaming Sphere',
                        'Fog Cloud',
                        'Gentle Repose',
                        'Goodberry',
                        'Grease',
                        'Guiding Bolt',
                        'Gust of Wind',
                        'Healing Word',
                        'Heat Metal',
                        'Hellish Rebuke',
                        'Heroism',
                        'Hold Person',
                        'Hunter’s Mark',
                        'Identify',
                        'Illusory Script',
                        'Inflict Wounds',
                        'Invisibility',
                        'Jump',
                        'Knock',
                        'Lesser Restoration',
                        'Levitate',
                        'Locate Animals or Plants',
                        'Locate Object',
                        'Longstrider',
                        'Mage Armor',
                        'Magic Missile',
                        'Magic Mouth',
                        'Magic Weapon',
                        'Mirror Image',
                        'Misty Step',
                        'Moonbeam',
                        'Pass without Trace',
                        'Prayer of Healing',
                        'Protection from Evil and Good',
                        'Protection from Poison',
                        'Purify Food and Drink',
                        'Ray of Enfeeblement',
                        'Rope Trick',
                        'Sanctuary',
                        'Scorching Ray',
                        'See Invisibility',
                        'Shatter',
                        'Shield',
                        'Shield of Faith',
                        'Silence',
                        'Silent Image',
                        'Sleep',
                        'Speak with Animals',
                        'Spider Climb',
                        'Spike Growth',
                        'Spiritual Weapon',
                        'Suggestion',
                        'Thunderwave',
                        'Unseen Servant',
                        'Warding Bond',
                        'Web',
                        'Zone of Truth',
                    ],
                    results: 99,
                }
            },
            {
                name: 'fire spell book',
                query: {
                    name: 'fire'
                },
                expected: {
                    names: [
                        'Delayed Blast Fireball',
                        'Faerie Fire',
                        'Fireball',
                        'Fire Bolt',
                        'Fire Shield',
                        'Fire Storm',
                        'Wall of Fire',
                    ],
                    results: 7,
                }
            },
            {
                name: 'fire cantrips',
                query: {
                    name: 'fire',
                    levels: [0],
                },
                expected: {
                    names: [
                        'Fire Bolt',
                    ],
                    results: 1,
                }
            },
            {
                name: 'ranged attacks',
                query: {
                    attackTypes: [
                        AttackType.Ranged,
                    ],
                },
                expected: {
                    names: [
                        'Chill Touch',
                        'Eldritch Blast',
                        'Fire Bolt',
                        'Guiding Bolt',
                        'Produce Flame',
                        'Ray of Enfeeblement',
                        'Ray of Frost',
                        'Scorching Ray',
                    ],
                    results: 8,
                }
            },
            {
                name: 'melee attacks',
                query: {
                    attackTypes: [
                        AttackType.Melee,
                    ],
                },
                expected: {
                    names: [
                        'Contagion',
                        'Flame Blade',
                        'Inflict Wounds',
                        'Mordenkainen’s Sword',
                        'Plane Shift',
                        'Shocking Grasp',
                        'Spiritual Weapon',
                        'Vampiric Touch',
                    ],
                    results: 8,
                }
            },
            {
                name: 'ranged and melee attacks',
                query: {
                    attackTypes: [
                        AttackType.Ranged,
                        AttackType.Melee,
                    ],
                },
                expected: {
                    names: [
                        'Chill Touch',
                        'Contagion',
                        'Eldritch Blast',
                        'Fire Bolt',
                        'Flame Blade',
                        'Guiding Bolt',
                        'Inflict Wounds',
                        'Mordenkainen’s Sword',
                        'Plane Shift',
                        'Produce Flame',
                        'Ray of Enfeeblement',
                        'Ray of Frost',
                        'Scorching Ray',
                        'Shocking Grasp',
                        'Spiritual Weapon',
                        'Vampiric Touch',
                    ],
                    results: 16,
                }
            },
            {
                name: 'dex saves',
                query: {
                    saveTypes: [
                        Ability.Dexterity,
                    ],
                },
                expected: {
                    names: [
                        'Acid Splash',
                        'Blade Barrier',
                        'Burning Hands',
                        'Call Lightning',
                        'Chain Lightning',
                        'Delayed Blast Fireball',
                        'Disintegrate',
                        'Faerie Fire',
                        'Fireball',
                        'Fire Storm',
                        'Flame Strike',
                        'Flaming Sphere',
                        'Glyph of Warding',
                        'Grease',
                        'Guardian of Faith',
                        'Hellish Rebuke',
                        'Ice Storm',
                        'Incendiary Cloud',
                        'Light',
                        'Lightning Bolt',
                        'Meteor Swarm',
                        'Reverse Gravity',
                        'Sacred Flame',
                        'Wall of Fire',
                        'Wall of Stone',
                        'Wall of Thorns',
                        'Web',
                    ],
                    results: 27,
                }
            },
            {
                name: 'con saves',
                query: {
                    saveTypes: [
                        Ability.Constitution,
                    ],
                },
                expected: {
                    names: [
                        'Blight',
                        'Blindness/Deafness',
                        'Circle of Death',
                        'Cloudkill',
                        'Cone of Cold',
                        'Enlarge/Reduce',
                        'Finger of Death',
                        'Flesh to Stone',
                        'Harm',
                        'Heat Metal',
                        'Holy Aura',
                        'Insect Plague',
                        'Levitate',
                        'Moonbeam',
                        'Poison Spray',
                        'Power Word Stun',
                        'Shatter',
                        'Stinking Cloud',
                        'Sunbeam',
                        'Sunburst',
                        'Thunderwave',
                    ],
                    results: 21,
                }
            },
            {
                name: 'dex and con saves',
                query: {
                    saveTypes: [
                        Ability.Constitution,
                        Ability.Dexterity,
                    ],
                },
                expected: {
                    names: [
                        'Acid Splash',
                        'Blade Barrier',
                        'Blight',
                        'Blindness/Deafness',
                        'Burning Hands',
                        'Call Lightning',
                        'Chain Lightning',
                        'Circle of Death',
                        'Cloudkill',
                        'Cone of Cold',
                        'Delayed Blast Fireball',
                        'Disintegrate',
                        'Enlarge/Reduce',
                        'Faerie Fire',
                        'Finger of Death',
                        'Fireball',
                        'Fire Storm',
                        'Flame Strike',
                        'Flaming Sphere',
                        'Flesh to Stone',
                        'Glyph of Warding',
                        'Grease',
                        'Guardian of Faith',
                        'Harm',
                        'Heat Metal',
                        'Hellish Rebuke',
                        'Holy Aura',
                        'Ice Storm',
                        'Incendiary Cloud',
                        'Insect Plague',
                        'Levitate',
                        'Light',
                        'Lightning Bolt',
                        'Meteor Swarm',
                        'Moonbeam',
                        'Poison Spray',
                        'Power Word Stun',
                        'Reverse Gravity',
                        'Sacred Flame',
                        'Shatter',
                        'Stinking Cloud',
                        'Sunbeam',
                        'Sunburst',
                        'Thunderwave',
                        'Wall of Fire',
                        'Wall of Stone',
                        'Wall of Thorns',
                        'Web',
                    ],
                    results: 48,
                }
            },
            {
                name: 'concentration spells',
                query: {
                    concentration: true,
                },
                expected: {
                    names: [
                        'Alter Self',
                        'Animal Shapes',
                        'Animate Objects',
                        'Antilife Shell',
                        'Antimagic Field',
                        'Arcane Eye',
                        'Bane',
                        'Banishment',
                        'Barkskin',
                        'Beacon of Hope',
                        'Bestow Curse',
                        'Blade Barrier',
                        'Bless',
                        'Blur',
                        'Branding Smite',
                        'Call Lightning',
                        'Calm Emotions',
                        'Clairvoyance',
                        'Cloudkill',
                        'Compulsion',
                        'Confusion',
                        'Conjure Animals',
                        'Conjure Celestial',
                        'Conjure Elemental',
                        'Conjure Fey',
                        'Conjure Minor Elementals',
                        'Conjure Woodland Beings',
                        'Control Water',
                        'Control Weather',
                        'Dancing Lights',
                        'Darkness',
                        'Delayed Blast Fireball',
                        'Detect Evil and Good',
                        'Detect Magic',
                        'Detect Poison and Disease',
                        'Detect Thoughts',
                        'Dispel Evil and Good',
                        'Divine Favor',
                        'Dominate Beast',
                        'Dominate Monster',
                        'Dominate Person',
                        'Earthquake',
                        'Enhance Ability',
                        'Enlarge/Reduce',
                        'Entangle',
                        'Expeditious Retreat',
                        'Eyebite',
                        'Faerie Fire',
                        'Fear',
                        'Find the Path',
                        'Flame Blade',
                        'Flaming Sphere',
                        'Flesh to Stone',
                        'Fly',
                        'Fog Cloud',
                        'Gaseous Form',
                        'Gate',
                        'Giant Insect',
                        'Globe of Invulnerability',
                        'Greater Invisibility',
                        'Guidance',
                        'Gust of Wind',
                        'Haste',
                        'Heat Metal',
                        'Heroism',
                        'Hold Monster',
                        'Hold Person',
                        'Holy Aura',
                        'Hunter’s Mark',
                        'Hypnotic Pattern',
                        'Incendiary Cloud',
                        'Insect Plague',
                        'Invisibility',
                        'Levitate',
                        'Locate Creature',
                        'Locate Object',
                        'Magic Weapon',
                        'Major Image',
                        'Maze',
                        'Mislead',
                        'Modify Memory',
                        'Moonbeam',
                        'Mordenkainen’s Sword',
                        'Move Earth',
                        'Otto’s Irresistible Dance',
                        'Pass without Trace',
                        'Phantasmal Killer',
                        'Polymorph',
                        'Project Image',
                        'Protection from Energy',
                        'Protection from Evil and Good',
                        'Ray of Enfeeblement',
                        'Resistance',
                        'Reverse Gravity',
                        'Scrying',
                        'Shapechange',
                        'Shield of Faith',
                        'Silence',
                        'Silent Image',
                        'Sleet Storm',
                        'Slow',
                        'Spider Climb',
                        'Spike Growth',
                        'Spirit Guardians',
                        'Stinking Cloud',
                        'Stoneskin',
                        'Storm of Vengeance',
                        'Suggestion',
                        'Sunbeam',
                        'Telekinesis',
                        'Tree Stride',
                        'True Polymorph',
                        'True Strike',
                        'Vampiric Touch',
                        'Wall of Fire',
                        'Wall of Force',
                        'Wall of Ice',
                        'Wall of Stone',
                        'Wall of Thorns',
                        'Web',
                        'Weird',
                        'Wind Wall',
                    ],
                    results: 122,
                }
            },
            {
                name: 'non-concentration spells',
                query: {
                    concentration: false,
                },
                expected: {
                    names: [
                        'Acid Splash',
                        'Aid',
                        'Alarm',
                        'Animal Friendship',
                        'Animal Messenger',
                        'Animate Dead',
                        'Antipathy/Sympathy',
                        'Arcane Lock',
                        'Astral Projection',
                        'Augury',
                        'Awaken',
                        'Blight',
                        'Blindness/Deafness',
                        'Blink',
                        'Burning Hands',
                        'Chain Lightning',
                        'Charm Person',
                        'Chill Touch',
                        'Circle of Death',
                        'Clone',
                        'Color Spray',
                        'Command',
                        'Commune',
                        'Commune with Nature',
                        'Comprehend Languages',
                        'Cone of Cold',
                        'Contact Other Plane',
                        'Contagion',
                        'Contingency',
                        'Continual Flame',
                        'Counterspell',
                        'Create Food and Water',
                        'Create or Destroy Water',
                        'Create Undead',
                        'Creation',
                        'Cure Wounds',
                        'Darkvision',
                        'Daylight',
                        'Death Ward',
                        'Demiplane',
                        'Dimension Door',
                        'Disguise Self',
                        'Disintegrate',
                        'Dispel Magic',
                        'Divination',
                        'Divine Word',
                        'Dream',
                        'Druidcraft',
                        'Eldritch Blast',
                        'Enthrall',
                        'Etherealness',
                        'Fabricate',
                        'False Life',
                        'Feather Fall',
                        'Feeblemind',
                        'Find Familiar',
                        'Find Steed',
                        'Find Traps',
                        'Finger of Death',
                        'Fireball',
                        'Fire Bolt',
                        'Fire Shield',
                        'Fire Storm',
                        'Flame Strike',
                        'Forbiddance',
                        'Forcecage',
                        'Foresight',
                        'Freedom of Movement',
                        'Geas',
                        'Gentle Repose',
                        'Glibness',
                        'Glyph of Warding',
                        'Goodberry',
                        'Grease',
                        'Greater Restoration',
                        'Guardian of Faith',
                        'Guards and Wards',
                        'Guiding Bolt',
                        'Hallow',
                        'Hallucinatory Terrain',
                        'Harm',
                        'Heal',
                        'Healing Word',
                        'Hellish Rebuke',
                        'Heroes’ Feast',
                        'Ice Storm',
                        'Identify',
                        'Illusory Script',
                        'Imprisonment',
                        'Inflict Wounds',
                        'Jump',
                        'Knock',
                        'Legend Lore',
                        'Lesser Restoration',
                        'Light',
                        'Lightning Bolt',
                        'Locate Animals or Plants',
                        'Longstrider',
                        'Mage Armor',
                        'Mage Hand',
                        'Magic Circle',
                        'Magic Jar',
                        'Magic Missile',
                        'Magic Mouth',
                        'Mass Cure Wounds',
                        'Mass Heal',
                        'Mass Healing Word',
                        'Mass Suggestion',
                        'Meld into Stone',
                        'Mending',
                        'Message',
                        'Meteor Swarm',
                        'Mind Blank',
                        'Minor Illusion',
                        'Mirage Arcane',
                        'Mirror Image',
                        'Misty Step',
                        'Nondetection',
                        'Passwall',
                        'Phantom Steed',
                        'Planar Ally',
                        'Planar Binding',
                        'Plane Shift',
                        'Plant Growth',
                        'Poison Spray',
                        'Power Word Kill',
                        'Power Word Stun',
                        'Prayer of Healing',
                        'Prestidigitation',
                        'Prismatic Spray',
                        'Prismatic Wall',
                        'Produce Flame',
                        'Programmed Illusion',
                        'Protection from Poison',
                        'Purify Food and Drink',
                        'Raise Dead',
                        'Ray of Frost',
                        'Regenerate',
                        'Reincarnate',
                        'Remove Curse',
                        'Resurrection',
                        'Revivify',
                        'Rope Trick',
                        'Sacred Flame',
                        'Sanctuary',
                        'Scorching Ray',
                        'See Invisibility',
                        'Seeming',
                        'Sending',
                        'Sequester',
                        'Shatter',
                        'Shield',
                        'Shillelagh',
                        'Shocking Grasp',
                        'Simulacrum',
                        'Sleep',
                        'Spare the Dying',
                        'Speak with Animals',
                        'Speak with Dead',
                        'Speak with Plants',
                        'Spiritual Weapon',
                        'Stone Shape',
                        'Sunburst',
                        'Symbol',
                        'Teleport',
                        'Teleportation Circle',
                        'Thaumaturgy',
                        'Thunderwave',
                        'Time Stop',
                        'Tongues',
                        'Transport via Plants',
                        'True Resurrection',
                        'True Seeing',
                        'Unseen Servant',
                        'Vicious Mockery',
                        'Warding Bond',
                        'Water Breathing',
                        'Water Walk',
                        'Wind Walk',
                        'Wish',
                        'Word of Recall',
                        'Zone of Truth',
                    ],
                    results: 182,
                }
            },
            {
                name: 'ritual spells',
                query: {
                    ritual: true,
                },
                expected: {
                    names: [
                        'Alarm',
                        'Animal Messenger',
                        'Augury',
                        'Commune',
                        'Commune with Nature',
                        'Comprehend Languages',
                        'Contact Other Plane',
                        'Detect Magic',
                        'Detect Poison and Disease',
                        'Divination',
                        'Find Familiar',
                        'Forbiddance',
                        'Gentle Repose',
                        'Identify',
                        'Illusory Script',
                        'Locate Animals or Plants',
                        'Magic Mouth',
                        'Meld into Stone',
                        'Phantom Steed',
                        'Purify Food and Drink',
                        'Silence',
                        'Speak with Animals',
                        'Unseen Servant',
                        'Water Breathing',
                        'Water Walk',
                    ],
                    results: 25,
                }
            },
            {
                name: 'non-ritual spells',
                query: {
                    ritual: false,
                },
                expected: {
                    names: [
                        'Acid Splash',
                        'Aid',
                        'Alter Self',
                        'Animal Friendship',
                        'Animal Shapes',
                        'Animate Dead',
                        'Animate Objects',
                        'Antilife Shell',
                        'Antimagic Field',
                        'Antipathy/Sympathy',
                        'Arcane Eye',
                        'Arcane Lock',
                        'Astral Projection',
                        'Awaken',
                        'Bane',
                        'Banishment',
                        'Barkskin',
                        'Beacon of Hope',
                        'Bestow Curse',
                        'Blade Barrier',
                        'Bless',
                        'Blight',
                        'Blindness/Deafness',
                        'Blink',
                        'Blur',
                        'Branding Smite',
                        'Burning Hands',
                        'Call Lightning',
                        'Calm Emotions',
                        'Chain Lightning',
                        'Charm Person',
                        'Chill Touch',
                        'Circle of Death',
                        'Clairvoyance',
                        'Clone',
                        'Cloudkill',
                        'Color Spray',
                        'Command',
                        'Compulsion',
                        'Cone of Cold',
                        'Confusion',
                        'Conjure Animals',
                        'Conjure Celestial',
                        'Conjure Elemental',
                        'Conjure Fey',
                        'Conjure Minor Elementals',
                        'Conjure Woodland Beings',
                        'Contagion',
                        'Contingency',
                        'Continual Flame',
                        'Control Water',
                        'Control Weather',
                        'Counterspell',
                        'Create Food and Water',
                        'Create or Destroy Water',
                        'Create Undead',
                        'Creation',
                        'Cure Wounds',
                        'Dancing Lights',
                        'Darkness',
                        'Darkvision',
                        'Daylight',
                        'Death Ward',
                        'Delayed Blast Fireball',
                        'Demiplane',
                        'Detect Evil and Good',
                        'Detect Thoughts',
                        'Dimension Door',
                        'Disguise Self',
                        'Disintegrate',
                        'Dispel Evil and Good',
                        'Dispel Magic',
                        'Divine Favor',
                        'Divine Word',
                        'Dominate Beast',
                        'Dominate Monster',
                        'Dominate Person',
                        'Dream',
                        'Druidcraft',
                        'Earthquake',
                        'Eldritch Blast',
                        'Enhance Ability',
                        'Enlarge/Reduce',
                        'Entangle',
                        'Enthrall',
                        'Etherealness',
                        'Expeditious Retreat',
                        'Eyebite',
                        'Fabricate',
                        'Faerie Fire',
                        'False Life',
                        'Fear',
                        'Feather Fall',
                        'Feeblemind',
                        'Find Steed',
                        'Find the Path',
                        'Find Traps',
                        'Finger of Death',
                        'Fireball',
                        'Fire Bolt',
                        'Fire Shield',
                        'Fire Storm',
                        'Flame Blade',
                        'Flame Strike',
                        'Flaming Sphere',
                        'Flesh to Stone',
                        'Fly',
                        'Fog Cloud',
                        'Forcecage',
                        'Foresight',
                        'Freedom of Movement',
                        'Gaseous Form',
                        'Gate',
                        'Geas',
                        'Giant Insect',
                        'Glibness',
                        'Globe of Invulnerability',
                        'Glyph of Warding',
                        'Goodberry',
                        'Grease',
                        'Greater Invisibility',
                        'Greater Restoration',
                        'Guardian of Faith',
                        'Guards and Wards',
                        'Guidance',
                        'Guiding Bolt',
                        'Gust of Wind',
                        'Hallow',
                        'Hallucinatory Terrain',
                        'Harm',
                        'Haste',
                        'Heal',
                        'Healing Word',
                        'Heat Metal',
                        'Hellish Rebuke',
                        'Heroes’ Feast',
                        'Heroism',
                        'Hold Monster',
                        'Hold Person',
                        'Holy Aura',
                        'Hunter’s Mark',
                        'Hypnotic Pattern',
                        'Ice Storm',
                        'Imprisonment',
                        'Incendiary Cloud',
                        'Inflict Wounds',
                        'Insect Plague',
                        'Invisibility',
                        'Jump',
                        'Knock',
                        'Legend Lore',
                        'Lesser Restoration',
                        'Levitate',
                        'Light',
                        'Lightning Bolt',
                        'Locate Creature',
                        'Locate Object',
                        'Longstrider',
                        'Mage Armor',
                        'Mage Hand',
                        'Magic Circle',
                        'Magic Jar',
                        'Magic Missile',
                        'Magic Weapon',
                        'Major Image',
                        'Mass Cure Wounds',
                        'Mass Heal',
                        'Mass Healing Word',
                        'Mass Suggestion',
                        'Maze',
                        'Mending',
                        'Message',
                        'Meteor Swarm',
                        'Mind Blank',
                        'Minor Illusion',
                        'Mirage Arcane',
                        'Mirror Image',
                        'Mislead',
                        'Misty Step',
                        'Modify Memory',
                        'Moonbeam',
                        'Mordenkainen’s Sword',
                        'Move Earth',
                        'Nondetection',
                        'Otto’s Irresistible Dance',
                        'Pass without Trace',
                        'Passwall',
                        'Phantasmal Killer',
                        'Planar Ally',
                        'Planar Binding',
                        'Plane Shift',
                        'Plant Growth',
                        'Poison Spray',
                        'Polymorph',
                        'Power Word Kill',
                        'Power Word Stun',
                        'Prayer of Healing',
                        'Prestidigitation',
                        'Prismatic Spray',
                        'Prismatic Wall',
                        'Produce Flame',
                        'Programmed Illusion',
                        'Project Image',
                        'Protection from Energy',
                        'Protection from Evil and Good',
                        'Protection from Poison',
                        'Raise Dead',
                        'Ray of Enfeeblement',
                        'Ray of Frost',
                        'Regenerate',
                        'Reincarnate',
                        'Remove Curse',
                        'Resistance',
                        'Resurrection',
                        'Reverse Gravity',
                        'Revivify',
                        'Rope Trick',
                        'Sacred Flame',
                        'Sanctuary',
                        'Scorching Ray',
                        'Scrying',
                        'See Invisibility',
                        'Seeming',
                        'Sending',
                        'Sequester',
                        'Shapechange',
                        'Shatter',
                        'Shield',
                        'Shield of Faith',
                        'Shillelagh',
                        'Shocking Grasp',
                        'Silent Image',
                        'Simulacrum',
                        'Sleep',
                        'Sleet Storm',
                        'Slow',
                        'Spare the Dying',
                        'Speak with Dead',
                        'Speak with Plants',
                        'Spider Climb',
                        'Spike Growth',
                        'Spirit Guardians',
                        'Spiritual Weapon',
                        'Stinking Cloud',
                        'Stone Shape',
                        'Stoneskin',
                        'Storm of Vengeance',
                        'Suggestion',
                        'Sunbeam',
                        'Sunburst',
                        'Symbol',
                        'Telekinesis',
                        'Teleport',
                        'Teleportation Circle',
                        'Thaumaturgy',
                        'Thunderwave',
                        'Time Stop',
                        'Tongues',
                        'Transport via Plants',
                        'Tree Stride',
                        'True Polymorph',
                        'True Resurrection',
                        'True Seeing',
                        'True Strike',
                        'Vampiric Touch',
                        'Vicious Mockery',
                        'Wall of Fire',
                        'Wall of Force',
                        'Wall of Ice',
                        'Wall of Stone',
                        'Wall of Thorns',
                        'Warding Bond',
                        'Web',
                        'Weird',
                        'Wind Walk',
                        'Wind Wall',
                        'Wish',
                        'Word of Recall',
                        'Zone of Truth',
                    ],
                    results: 279,
                }
            },
            {
                name: 'paladin cantrips that require concentration',
                query: {
                    concentration: true,
                    classes: [
                        'Paladin',
                    ],
                    levels: [0],
                },
                expected: {
                    names: [],
                    results: 0,
                }
            },
            {
                name: 'reaction spells',
                query: {
                    castingTime: [
                        CastingTime.Reaction,
                    ],
                },
                expected: {
                    names: [
                        'Counterspell',
                        'Feather Fall',
                        'Hellish Rebuke',
                        'Shield',
                    ],
                    results: 4,
                }
            },
            {
                name: 'bonus action spells',
                query: {
                    castingTime: [
                        CastingTime.BonusAction,
                    ],
                },
                expected: {
                    names: [
                        'Branding Smite',
                        'Divine Favor',
                        'Divine Word',
                        'Expeditious Retreat',
                        'Flame Blade',
                        'Healing Word',
                        'Hunter’s Mark',
                        'Magic Weapon',
                        'Mass Healing Word',
                        'Misty Step',
                        'Sanctuary',
                        'Shield of Faith',
                        'Shillelagh',
                        'Spiritual Weapon',
                    ],
                    results: 14,
                }
            },
            {
                name: 'bonus action and reaction spells',
                query: {
                    castingTime: [
                        CastingTime.Reaction,
                        CastingTime.BonusAction,
                    ],
                },
                expected: {
                    names: [
                        'Branding Smite',
                        'Counterspell',
                        'Divine Favor',
                        'Divine Word',
                        'Expeditious Retreat',
                        'Feather Fall',
                        'Flame Blade',
                        'Healing Word',
                        'Hellish Rebuke',
                        'Hunter’s Mark',
                        'Magic Weapon',
                        'Mass Healing Word',
                        'Misty Step',
                        'Sanctuary',
                        'Shield',
                        'Shield of Faith',
                        'Shillelagh',
                        'Spiritual Weapon',
                    ],
                    results: 18,
                }
            },
            {
                name: 'spells with verbal components',
                query: {
                    components: {
                        verbal: true,
                    }
                },
                expected: {
                    names: [
                        'Acid Splash',
                        'Aid',
                        'Alarm',
                        'Alter Self',
                        'Animal Friendship',
                        'Animal Messenger',
                        'Animal Shapes',
                        'Animate Dead',
                        'Animate Objects',
                        'Antilife Shell',
                        'Antimagic Field',
                        'Antipathy/Sympathy',
                        'Arcane Eye',
                        'Arcane Lock',
                        'Astral Projection',
                        'Augury',
                        'Awaken',
                        'Bane',
                        'Banishment',
                        'Barkskin',
                        'Beacon of Hope',
                        'Bestow Curse',
                        'Blade Barrier',
                        'Bless',
                        'Blight',
                        'Blindness/Deafness',
                        'Blink',
                        'Blur',
                        'Branding Smite',
                        'Burning Hands',
                        'Call Lightning',
                        'Calm Emotions',
                        'Chain Lightning',
                        'Charm Person',
                        'Chill Touch',
                        'Circle of Death',
                        'Clairvoyance',
                        'Clone',
                        'Cloudkill',
                        'Color Spray',
                        'Command',
                        'Commune',
                        'Commune with Nature',
                        'Comprehend Languages',
                        'Compulsion',
                        'Cone of Cold',
                        'Confusion',
                        'Conjure Animals',
                        'Conjure Celestial',
                        'Conjure Elemental',
                        'Conjure Fey',
                        'Conjure Minor Elementals',
                        'Conjure Woodland Beings',
                        'Contact Other Plane',
                        'Contagion',
                        'Contingency',
                        'Continual Flame',
                        'Control Water',
                        'Control Weather',
                        'Create Food and Water',
                        'Create or Destroy Water',
                        'Create Undead',
                        'Creation',
                        'Cure Wounds',
                        'Dancing Lights',
                        'Darkness',
                        'Darkvision',
                        'Daylight',
                        'Death Ward',
                        'Delayed Blast Fireball',
                        'Detect Evil and Good',
                        'Detect Magic',
                        'Detect Poison and Disease',
                        'Detect Thoughts',
                        'Dimension Door',
                        'Disguise Self',
                        'Disintegrate',
                        'Dispel Evil and Good',
                        'Dispel Magic',
                        'Divination',
                        'Divine Favor',
                        'Divine Word',
                        'Dominate Beast',
                        'Dominate Monster',
                        'Dominate Person',
                        'Dream',
                        'Druidcraft',
                        'Earthquake',
                        'Eldritch Blast',
                        'Enhance Ability',
                        'Enlarge/Reduce',
                        'Entangle',
                        'Enthrall',
                        'Etherealness',
                        'Expeditious Retreat',
                        'Eyebite',
                        'Fabricate',
                        'Faerie Fire',
                        'False Life',
                        'Fear',
                        'Feather Fall',
                        'Feeblemind',
                        'Find Familiar',
                        'Find Steed',
                        'Find the Path',
                        'Find Traps',
                        'Finger of Death',
                        'Fireball',
                        'Fire Bolt',
                        'Fire Shield',
                        'Fire Storm',
                        'Flame Blade',
                        'Flame Strike',
                        'Flaming Sphere',
                        'Flesh to Stone',
                        'Fly',
                        'Fog Cloud',
                        'Forbiddance',
                        'Forcecage',
                        'Foresight',
                        'Freedom of Movement',
                        'Gaseous Form',
                        'Gate',
                        'Geas',
                        'Gentle Repose',
                        'Giant Insect',
                        'Glibness',
                        'Globe of Invulnerability',
                        'Glyph of Warding',
                        'Goodberry',
                        'Grease',
                        'Greater Invisibility',
                        'Greater Restoration',
                        'Guardian of Faith',
                        'Guards and Wards',
                        'Guidance',
                        'Guiding Bolt',
                        'Gust of Wind',
                        'Hallow',
                        'Hallucinatory Terrain',
                        'Harm',
                        'Haste',
                        'Heal',
                        'Healing Word',
                        'Heat Metal',
                        'Hellish Rebuke',
                        'Heroes’ Feast',
                        'Heroism',
                        'Hold Monster',
                        'Hold Person',
                        'Holy Aura',
                        'Hunter’s Mark',
                        'Ice Storm',
                        'Identify',
                        'Imprisonment',
                        'Incendiary Cloud',
                        'Inflict Wounds',
                        'Insect Plague',
                        'Invisibility',
                        'Jump',
                        'Knock',
                        'Legend Lore',
                        'Lesser Restoration',
                        'Levitate',
                        'Light',
                        'Lightning Bolt',
                        'Locate Animals or Plants',
                        'Locate Creature',
                        'Locate Object',
                        'Longstrider',
                        'Mage Armor',
                        'Mage Hand',
                        'Magic Circle',
                        'Magic Jar',
                        'Magic Missile',
                        'Magic Mouth',
                        'Magic Weapon',
                        'Major Image',
                        'Mass Cure Wounds',
                        'Mass Heal',
                        'Mass Healing Word',
                        'Mass Suggestion',
                        'Maze',
                        'Meld into Stone',
                        'Mending',
                        'Message',
                        'Meteor Swarm',
                        'Mind Blank',
                        'Mirage Arcane',
                        'Mirror Image',
                        'Misty Step',
                        'Modify Memory',
                        'Moonbeam',
                        'Mordenkainen’s Sword',
                        'Move Earth',
                        'Nondetection',
                        'Otto’s Irresistible Dance',
                        'Pass without Trace',
                        'Passwall',
                        'Phantasmal Killer',
                        'Phantom Steed',
                        'Planar Ally',
                        'Planar Binding',
                        'Plane Shift',
                        'Plant Growth',
                        'Poison Spray',
                        'Polymorph',
                        'Power Word Kill',
                        'Power Word Stun',
                        'Prayer of Healing',
                        'Prestidigitation',
                        'Prismatic Spray',
                        'Prismatic Wall',
                        'Produce Flame',
                        'Programmed Illusion',
                        'Project Image',
                        'Protection from Energy',
                        'Protection from Evil and Good',
                        'Protection from Poison',
                        'Purify Food and Drink',
                        'Raise Dead',
                        'Ray of Enfeeblement',
                        'Ray of Frost',
                        'Regenerate',
                        'Reincarnate',
                        'Remove Curse',
                        'Resistance',
                        'Resurrection',
                        'Reverse Gravity',
                        'Revivify',
                        'Rope Trick',
                        'Sacred Flame',
                        'Sanctuary',
                        'Scorching Ray',
                        'Scrying',
                        'See Invisibility',
                        'Seeming',
                        'Sending',
                        'Sequester',
                        'Shapechange',
                        'Shatter',
                        'Shield',
                        'Shield of Faith',
                        'Shillelagh',
                        'Shocking Grasp',
                        'Silence',
                        'Silent Image',
                        'Simulacrum',
                        'Sleep',
                        'Sleet Storm',
                        'Slow',
                        'Spare the Dying',
                        'Speak with Animals',
                        'Speak with Dead',
                        'Speak with Plants',
                        'Spider Climb',
                        'Spike Growth',
                        'Spirit Guardians',
                        'Spiritual Weapon',
                        'Stinking Cloud',
                        'Stone Shape',
                        'Stoneskin',
                        'Storm of Vengeance',
                        'Suggestion',
                        'Sunbeam',
                        'Sunburst',
                        'Symbol',
                        'Telekinesis',
                        'Teleport',
                        'Teleportation Circle',
                        'Thaumaturgy',
                        'Thunderwave',
                        'Time Stop',
                        'Tongues',
                        'Transport via Plants',
                        'Tree Stride',
                        'True Polymorph',
                        'True Resurrection',
                        'True Seeing',
                        'Unseen Servant',
                        'Vampiric Touch',
                        'Vicious Mockery',
                        'Wall of Fire',
                        'Wall of Force',
                        'Wall of Ice',
                        'Wall of Stone',
                        'Wall of Thorns',
                        'Warding Bond',
                        'Water Breathing',
                        'Water Walk',
                        'Web',
                        'Weird',
                        'Wind Walk',
                        'Wind Wall',
                        'Wish',
                        'Word of Recall',
                        'Zone of Truth',
                    ],
                    results: 297,
                }
            },
            {
                name: 'spells with ONLY verbal components',
                query: {
                    components: {
                        material: false,
                        somatic: false,
                        verbal: true,
                    }
                },
                expected: {
                    names: [
                        'Blindness/Deafness',
                        'Blur',
                        'Branding Smite',
                        'Command',
                        'Contact Other Plane',
                        'Dimension Door',
                        'Divine Word',
                        'Faerie Fire',
                        'Geas',
                        'Glibness',
                        'Guardian of Faith',
                        'Healing Word',
                        'Hunter’s Mark',
                        'Knock',
                        'Mass Healing Word',
                        'Misty Step',
                        'Otto’s Irresistible Dance',
                        'Power Word Kill',
                        'Power Word Stun',
                        'Prayer of Healing',
                        'Teleport',
                        'Thaumaturgy',
                        'Time Stop',
                        'Vicious Mockery',
                        'Wish',
                        'Word of Recall',
                    ],
                    results: 26,
                }
            },
            {
                name: 'spells without verbal components',
                query: {
                    components: {
                        verbal: false,
                    }
                },
                expected: {
                    names: [
                        'Counterspell',
                        'Demiplane',
                        'Hypnotic Pattern',
                        'Illusory Script',
                        'Minor Illusion',
                        'Mislead',
                        'True Strike',
                    ],
                    results: 7,
                }
            },
            {
                name: 'spells without material components',
                query: {
                    components: {
                        material: false,
                    }
                },
                expected: {
                    names: [
                        'Acid Splash',
                        'Alter Self',
                        'Animal Shapes',
                        'Animate Objects',
                        'Antilife Shell',
                        'Beacon of Hope',
                        'Bestow Curse',
                        'Blade Barrier',
                        'Blight',
                        'Blindness/Deafness',
                        'Blink',
                        'Blur',
                        'Branding Smite',
                        'Burning Hands',
                        'Call Lightning',
                        'Calm Emotions',
                        'Charm Person',
                        'Chill Touch',
                        'Cloudkill',
                        'Command',
                        'Commune with Nature',
                        'Compulsion',
                        'Conjure Animals',
                        'Conjure Celestial',
                        'Conjure Fey',
                        'Conjure Minor Elementals',
                        'Contact Other Plane',
                        'Contagion',
                        'Counterspell',
                        'Create Food and Water',
                        'Cure Wounds',
                        'Daylight',
                        'Death Ward',
                        'Demiplane',
                        'Detect Evil and Good',
                        'Detect Magic',
                        'Dimension Door',
                        'Disguise Self',
                        'Dispel Magic',
                        'Divine Favor',
                        'Divine Word',
                        'Dominate Beast',
                        'Dominate Monster',
                        'Dominate Person',
                        'Druidcraft',
                        'Eldritch Blast',
                        'Entangle',
                        'Enthrall',
                        'Etherealness',
                        'Expeditious Retreat',
                        'Eyebite',
                        'Fabricate',
                        'Faerie Fire',
                        'Find Steed',
                        'Find Traps',
                        'Finger of Death',
                        'Fire Bolt',
                        'Fire Storm',
                        'Fog Cloud',
                        'Geas',
                        'Giant Insect',
                        'Glibness',
                        'Greater Invisibility',
                        'Guardian of Faith',
                        'Guidance',
                        'Guiding Bolt',
                        'Harm',
                        'Heal',
                        'Healing Word',
                        'Hellish Rebuke',
                        'Heroism',
                        'Hunter’s Mark',
                        'Incendiary Cloud',
                        'Inflict Wounds',
                        'Knock',
                        'Lesser Restoration',
                        'Mage Hand',
                        'Magic Missile',
                        'Magic Weapon',
                        'Mass Cure Wounds',
                        'Mass Heal',
                        'Mass Healing Word',
                        'Maze',
                        'Meld into Stone',
                        'Meteor Swarm',
                        'Mind Blank',
                        'Mirage Arcane',
                        'Mirror Image',
                        'Mislead',
                        'Misty Step',
                        'Modify Memory',
                        'Otto’s Irresistible Dance',
                        'Phantasmal Killer',
                        'Phantom Steed',
                        'Planar Ally',
                        'Plant Growth',
                        'Poison Spray',
                        'Power Word Kill',
                        'Power Word Stun',
                        'Prayer of Healing',
                        'Prestidigitation',
                        'Prismatic Spray',
                        'Prismatic Wall',
                        'Produce Flame',
                        'Protection from Energy',
                        'Protection from Poison',
                        'Purify Food and Drink',
                        'Ray of Enfeeblement',
                        'Ray of Frost',
                        'Remove Curse',
                        'Sacred Flame',
                        'Scorching Ray',
                        'Seeming',
                        'Shield',
                        'Shocking Grasp',
                        'Silence',
                        'Spare the Dying',
                        'Speak with Animals',
                        'Speak with Plants',
                        'Spiritual Weapon',
                        'Storm of Vengeance',
                        'Telekinesis',
                        'Teleport',
                        'Thaumaturgy',
                        'Thunderwave',
                        'Time Stop',
                        'Transport via Plants',
                        'Tree Stride',
                        'True Strike',
                        'Vampiric Touch',
                        'Vicious Mockery',
                        'Weird',
                        'Wish',
                        'Word of Recall',
                        'Zone of Truth'
                    ],
                    results: 135,
                }
            },
            {
                name: 'spells with verbal and material components',
                query: {
                    components: {
                        material: true,
                        verbal: true,
                    }
                },
                expected: {
                    names: [
                        'Aid',
                        'Alarm',
                        'Animal Friendship',
                        'Animal Messenger',
                        'Animate Dead',
                        'Antimagic Field',
                        'Antipathy/Sympathy',
                        'Arcane Eye',
                        'Arcane Lock',
                        'Astral Projection',
                        'Augury',
                        'Awaken',
                        'Bane',
                        'Banishment',
                        'Barkskin',
                        'Bless',
                        'Chain Lightning',
                        'Circle of Death',
                        'Clairvoyance',
                        'Clone',
                        'Color Spray',
                        'Commune',
                        'Comprehend Languages',
                        'Cone of Cold',
                        'Confusion',
                        'Conjure Elemental',
                        'Conjure Woodland Beings',
                        'Contingency',
                        'Continual Flame',
                        'Control Water',
                        'Control Weather',
                        'Create or Destroy Water',
                        'Create Undead',
                        'Creation',
                        'Dancing Lights',
                        'Darkness',
                        'Darkvision',
                        'Delayed Blast Fireball',
                        'Detect Poison and Disease',
                        'Detect Thoughts',
                        'Disintegrate',
                        'Dispel Evil and Good',
                        'Divination',
                        'Dream',
                        'Earthquake',
                        'Enhance Ability',
                        'Enlarge/Reduce',
                        'False Life',
                        'Fear',
                        'Feather Fall',
                        'Feeblemind',
                        'Find Familiar',
                        'Find the Path',
                        'Fireball',
                        'Fire Shield',
                        'Flame Blade',
                        'Flame Strike',
                        'Flaming Sphere',
                        'Flesh to Stone',
                        'Fly',
                        'Forbiddance',
                        'Forcecage',
                        'Foresight',
                        'Freedom of Movement',
                        'Gaseous Form',
                        'Gate',
                        'Gentle Repose',
                        'Globe of Invulnerability',
                        'Glyph of Warding',
                        'Goodberry',
                        'Grease',
                        'Greater Restoration',
                        'Guards and Wards',
                        'Gust of Wind',
                        'Hallow',
                        'Hallucinatory Terrain',
                        'Haste',
                        'Heat Metal',
                        'Heroes’ Feast',
                        'Hold Monster',
                        'Hold Person',
                        'Holy Aura',
                        'Ice Storm',
                        'Identify',
                        'Imprisonment',
                        'Insect Plague',
                        'Invisibility',
                        'Jump',
                        'Legend Lore',
                        'Levitate',
                        'Light',
                        'Lightning Bolt',
                        'Locate Animals or Plants',
                        'Locate Creature',
                        'Locate Object',
                        'Longstrider',
                        'Mage Armor',
                        'Magic Circle',
                        'Magic Jar',
                        'Magic Mouth',
                        'Major Image',
                        'Mass Suggestion',
                        'Mending',
                        'Message',
                        'Moonbeam',
                        'Mordenkainen’s Sword',
                        'Move Earth',
                        'Nondetection',
                        'Pass without Trace',
                        'Passwall',
                        'Planar Binding',
                        'Plane Shift',
                        'Polymorph',
                        'Programmed Illusion',
                        'Project Image',
                        'Protection from Evil and Good',
                        'Raise Dead',
                        'Regenerate',
                        'Reincarnate',
                        'Resistance',
                        'Resurrection',
                        'Reverse Gravity',
                        'Revivify',
                        'Rope Trick',
                        'Sanctuary',
                        'Scrying',
                        'See Invisibility',
                        'Sending',
                        'Sequester',
                        'Shapechange',
                        'Shatter',
                        'Shield of Faith',
                        'Shillelagh',
                        'Silent Image',
                        'Simulacrum',
                        'Sleep',
                        'Sleet Storm',
                        'Slow',
                        'Speak with Dead',
                        'Spider Climb',
                        'Spike Growth',
                        'Spirit Guardians',
                        'Stinking Cloud',
                        'Stone Shape',
                        'Stoneskin',
                        'Suggestion',
                        'Sunbeam',
                        'Sunburst',
                        'Symbol',
                        'Teleportation Circle',
                        'Tongues',
                        'True Polymorph',
                        'True Resurrection',
                        'True Seeing',
                        'Unseen Servant',
                        'Wall of Fire',
                        'Wall of Force',
                        'Wall of Ice',
                        'Wall of Stone',
                        'Wall of Thorns',
                        'Warding Bond',
                        'Water Breathing',
                        'Water Walk',
                        'Web',
                        'Wind Walk',
                        'Wind Wall'
                    ],
                    results: 166,
                }
            },
            {
                name: 'spells with ONLY verbal and material components',
                query: {
                    components: {
                        material: true,
                        somatic: false,
                        verbal: true,
                    }
                },
                expected: {
                    names: [
                        'Darkness',
                        'Feather Fall',
                        'Light',
                        'Mass Suggestion',
                        'Suggestion',
                        'Teleportation Circle',
                        'Tongues',
                    ],
                    results: 7,
                }
            },
            {
                name: 'force spells',
                query: {
                    damageTypes: [
                        DamageType.Force,
                    ],
                },
                expected: {
                    names: [
                        'Dimension Door',
                        'Disintegrate',
                        'Eldritch Blast',
                        'Etherealness',
                        'Magic Missile',
                        'Mordenkainen’s Sword',
                        'Spiritual Weapon',
                        'Teleport',
                    ],
                    results: 8
                },
            },
            {
                name: 'fire spells',
                query: {
                    damageTypes: [
                        DamageType.Fire,
                    ],
                },
                expected: {
                    names: [
                        'Burning Hands',
                        'Delayed Blast Fireball',
                        'Fireball',
                        'Fire Bolt',
                        'Fire Shield',
                        'Fire Storm',
                        'Flame Blade',
                        'Flame Strike',
                        'Flaming Sphere',
                        'Glyph of Warding',
                        'Heat Metal',
                        'Hellish Rebuke',
                        'Incendiary Cloud',
                        'Meteor Swarm',
                        'Prismatic Spray',
                        'Prismatic Wall',
                        'Produce Flame',
                        'Scorching Ray',
                        'Wall of Fire',
                        'Web',
                    ],
                    results: 20
                },
            },
            {
                name: 'fire or acid spells',
                query: {
                    damageTypes: [
                        DamageType.Fire,
                        DamageType.Acid,
                    ],
                },
                expected: {
                    names: [
                        'Acid Splash',
                        'Burning Hands',
                        'Delayed Blast Fireball',
                        'Fireball',
                        'Fire Bolt',
                        'Fire Shield',
                        'Fire Storm',
                        'Flame Blade',
                        'Flame Strike',
                        'Flaming Sphere',
                        'Glyph of Warding',
                        'Heat Metal',
                        'Hellish Rebuke',
                        'Incendiary Cloud',
                        'Meteor Swarm',
                        'Prismatic Spray',
                        'Prismatic Wall',
                        'Produce Flame',
                        'Scorching Ray',
                        'Storm of Vengeance',
                        'Wall of Fire',
                        'Web',
                    ],
                    results: 22
                },
            },
            {
                name: 'exhaustion spells',
                query: {
                    conditions: [
                        'Exhaustion'
                    ]
                },
                expected: {
                    names: [
                        'Greater Restoration'
                    ],
                    results: 1,
                }
            },
            {
                name: 'exhaustion spells, lowercase',
                query: {
                    conditions: [
                        'exhaustion'
                    ]
                },
                expected: {
                    names: [
                        'Greater Restoration'
                    ],
                    results: 1,
                }
            },
            {
                name: 'charmed spells',
                query: {
                    conditions: [
                        'Charmed'
                    ]
                },
                expected: {
                    names: [
                        'Animal Friendship',
                        'Awaken',
                        'Calm Emotions',
                        'Charm Person',
                        'Compulsion',
                        'Dispel Evil and Good',
                        'Dominate Beast',
                        'Dominate Monster',
                        'Dominate Person',
                        'Enthrall',
                        'Geas',
                        'Hallow',
                        'Hypnotic Pattern',
                        'Mass Suggestion',
                        'Mind Blank',
                        'Modify Memory',
                        'Otto’s Irresistible Dance',
                        'Protection from Evil and Good',
                        'Sleep',
                        'Suggestion',
                    ],
                    results: 20,
                }
            },
            {
                name: 'charmed and frightened spells',
                query: {
                    conditions: [
                        'Charmed',
                        'Frightened'
                    ]
                },
                expected: {
                    names: [
                        'Animal Friendship',
                        'Antipathy/Sympathy',
                        'Awaken',
                        'Calm Emotions',
                        'Charm Person',
                        'Compulsion',
                        'Dispel Evil and Good',
                        'Dominate Beast',
                        'Dominate Monster',
                        'Dominate Person',
                        'Enthrall',
                        'Eyebite',
                        'Fear',
                        'Geas',
                        'Hallow',
                        'Heroes’ Feast',
                        'Heroism',
                        'Hypnotic Pattern',
                        'Mass Suggestion',
                        'Mind Blank',
                        'Modify Memory',
                        'Otto’s Irresistible Dance',
                        'Phantasmal Killer',
                        'Protection from Evil and Good',
                        'Sleep',
                        'Suggestion',
                        'Symbol',
                        'Weird',
                    ],
                    results: 28,
                }
            },
            {
                name: '8 hour spells',
                query: {
                    durations: [
                        Duration.Hours8,
                    ]
                },
                expected: {
                    names: [
                        'Aid',
                        'Alarm',
                        'Control Weather',
                        'Darkvision',
                        'Death Ward',
                        'Dream',
                        'Etherealness',
                        'Foresight',
                        'Guardian of Faith',
                        'Mage Armor',
                        'Meld into Stone',
                        'Nondetection',
                        'Seeming',
                        'Suggestion',
                        'Wind Walk',
                    ],
                    results: 15,
                }
            },
            {
                name: '8 or 24 hours spells',
                query: {
                    durations: [
                        Duration.Hours8,
                        Duration.Hours24,
                    ]
                },
                expected: {
                    names: [
                        'Aid',
                        'Alarm',
                        'Animal Friendship',
                        'Animal Messenger',
                        'Animal Shapes',
                        'Control Weather',
                        'Darkvision',
                        'Death Ward',
                        'Dream',
                        'Etherealness',
                        'Foresight',
                        'Guardian of Faith',
                        'Guards and Wards',
                        'Hallucinatory Terrain',
                        'Mage Armor',
                        'Mass Suggestion',
                        'Meld into Stone',
                        'Mind Blank',
                        'Nondetection',
                        'Planar Binding',
                        'Seeming',
                        'Suggestion',
                        'Water Breathing',
                        'Wind Walk',],
                    results: 24,
                }
            },
            {
                name: 'Fire Bolt',
                query: {
                    name: 'fire bolt',
                },
                expected: {
                    names: [
                        'Fire Bolt'
                    ],
                    results: 1
                }
            },
            {
                name: 'First and Last',
                query: {
                    name: 'beacon hope',
                },
                expected: {
                    names: [
                        'Beacon of Hope'
                    ],
                    results: 1
                }
            },
            {
                name: 'Fire Ball',
                query: {
                    name: 'fire ball',
                },
                expected: {
                    names: [
                        'Delayed Blast Fireball',
                        'Fireball'
                    ],
                    results: 2
                }
            }
        ];

    const spellAPI = new SpellAPI(spells as Spell[]);

    tests.forEach((test) => {
        it(test.name, (done) => {
            const actual = spellAPI.query(test.query);
            expect(actual.length).toEqual(test.expected.results);

            const actualNames = actual.map((spell) => spell.name);
            expect(actualNames).toStrictEqual(test.expected.names);

            actual.forEach((spell, index) => {
                expect(spell.name.toLowerCase()).toContain(test.expected.names[index].toLowerCase());

                if (test.query.classes !== undefined && test.query.classes.length > 0) {
                    const lowercaseList = spell.classes.map((value) => value.toLowerCase());
                    const filteredList = test.query.classes.filter((value) => lowercaseList.includes(value.toLowerCase()));
                    expect(filteredList.length).toBeGreaterThan(0);
                }
                if (test.query.levels !== undefined && test.query.levels.length > 0) {
                    expect(test.query.levels).toContain(spell.level);
                }
                if (test.query.schools !== undefined && test.query.schools.length > 0) {
                    expect(test.query.schools).toContain(spell.school);
                }
            });
            done();
        })
    });
});

describe('validation', () => {

    const spellInterface = io_ts.interface({
        name: io_ts.string,
        level: io_ts.number,
        school: io_ts.union([
            io_ts.literal('abjuration'),
            io_ts.literal('conjuration'),
            io_ts.literal('divination'),
            io_ts.literal('enchantment'),
            io_ts.literal('evocation'),
            io_ts.literal('illusion'),
            io_ts.literal('necromancy'),
            io_ts.literal('transmutation'),
        ]),
        castingTime: io_ts.union([
            io_ts.literal('reaction'),
            io_ts.literal('bonus action'),
            io_ts.literal('action'),
            io_ts.literal('1 minute'),
            io_ts.literal('10 minutes'),
            io_ts.literal('1 hour'),
            io_ts.literal('8 hours'),
            io_ts.literal('12 hours'),
            io_ts.literal('24 hours'),
        ]),
        damageType: optional(
            io_ts.array(
                io_ts.union([
                    io_ts.literal('acid'),
                    io_ts.literal('bludgeoning'),
                    io_ts.literal('cold'),
                    io_ts.literal('fire'),
                    io_ts.literal('force'),
                    io_ts.literal('lightning'),
                    io_ts.literal('necrotic'),
                    io_ts.literal('piercing'),
                    io_ts.literal('poison'),
                    io_ts.literal('psychic'),
                    io_ts.literal('radiant'),
                    io_ts.literal('slashing'),
                    io_ts.literal('thunder'),
                ]),
            )
        ),
        duration: io_ts.union([
            io_ts.literal('instantaneous'),
            io_ts.literal('1 round'),
            io_ts.literal('1 minute'),
            io_ts.literal('10 minutes'),
            io_ts.literal('1 hour'),
            io_ts.literal('2 hours'),
            io_ts.literal('8 hours'),
            io_ts.literal('12 hours'),
            io_ts.literal('24 hours'),
            io_ts.literal('1 day'),
            io_ts.literal('7 days'),
            io_ts.literal('10 days'),
            io_ts.literal('30 days'),
            io_ts.literal('special'),
            io_ts.literal('until dispelled'),
        ]),
        range: io_ts.union([
            io_ts.literal('self'),
            io_ts.literal('touch'),
            io_ts.literal('sight'),
            io_ts.literal('5 feet'),
            io_ts.literal('10 feet'),
            io_ts.literal('30 feet'),
            io_ts.literal('60 feet'),
            io_ts.literal('90 feet'),
            io_ts.literal('100 feet'),
            io_ts.literal('120 feet'),
            io_ts.literal('150 feet'),
            io_ts.literal('300 feet'),
            io_ts.literal('500 feet'),
            io_ts.literal('1 mile'),
            io_ts.literal('500 miles'),
            io_ts.literal('special'),
            io_ts.literal('unlimited'),
        ]),
        area: optional(io_ts.interface({
            shape: io_ts.union([
                io_ts.literal('cone'),
                io_ts.literal('cube'),
                io_ts.literal('cylinder'),
                io_ts.literal('line'),
                io_ts.literal('sphere'),
            ]),
            size: io_ts.number,
            unit: io_ts.union([
                io_ts.literal('feet'),
                io_ts.literal('miles'),
            ]),
        })),
        components: io_ts.any,
        description: io_ts.array(descriptionInterface),
        higherLevels: optional(io_ts.array(descriptionInterface)),
        ritual: io_ts.boolean,
        attack: optional(io_ts.union([
            io_ts.literal('melee'),
            io_ts.literal('ranged'),
        ])),
        save: optional(io_ts.union([
            io_ts.literal('strength'),
            io_ts.literal('dexterity'),
            io_ts.literal('constitution'),
            io_ts.literal('intelligence'),
            io_ts.literal('wisdom'),
            io_ts.literal('charisma'),
        ])),
        concentration: io_ts.boolean,
        reactionTrigger: optional(io_ts.string),
        classes: io_ts.array(io_ts.string),
        conditions: optional(io_ts.array(io_ts.string)),
    });

    (spells as Spell[]).forEach((spell) => {
        it(spell.name, (done) => {
            const result = spellInterface.decode(spell);
            ThrowReporter.report(result);
            done();
        });
    })
});
